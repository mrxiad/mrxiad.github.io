

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Mrxiad">
  <meta name="keywords" content="">
  
    <meta name="description" content="文件基本操作创建文件123456789101112131415package mainimport (	&quot;log&quot;	&quot;os&quot;)func main() &#123;	newfile, err :&#x3D; os.Create(&quot;test.txt&quot;)	if err !&#x3D; nil &#123;		log.Fatal(err)	&#125;	log.Pr">
<meta property="og:type" content="article">
<meta property="og:title" content="go语法">
<meta property="og:url" content="http://example.com/2024/03/24/go/go%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/index.html">
<meta property="og:site_name" content="Mrxiad">
<meta property="og:description" content="文件基本操作创建文件123456789101112131415package mainimport (	&quot;log&quot;	&quot;os&quot;)func main() &#123;	newfile, err :&#x3D; os.Create(&quot;test.txt&quot;)	if err !&#x3D; nil &#123;		log.Fatal(err)	&#125;	log.Pr">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-03-24T14:40:40.000Z">
<meta property="article:modified_time" content="2024-04-08T11:23:11.372Z">
<meta property="article:author" content="Mrxiad">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>go语法 - Mrxiad</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Mrxiad</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="go语法"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-24 22:40" pubdate>
          2024年3月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          20k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          170 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">go语法</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="文件基本操作"><a href="#文件基本操作" class="headerlink" title="文件基本操作"></a>文件基本操作</h1><h2 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	newfile, err := os.Create(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>	log.Println(newfile)<br>	newfile.Close()<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="Truncate裁剪文件"><a href="#Truncate裁剪文件" class="headerlink" title="Truncate裁剪文件"></a>Truncate裁剪文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-comment">// 裁剪一个文件到100个字节。</span><br>	<span class="hljs-comment">// 如果文件本来就少于100个字节，则文件中原始内容得以保留，剩余的字节以null字节填充。</span><br>	<span class="hljs-comment">// 如果文件本来超过100个字节，则超过的字节会被抛弃。</span><br>	<span class="hljs-comment">// 这样我们总是得到精确的100个字节的文件。</span><br>	<span class="hljs-comment">// 传入0则会清空文件。</span><br><br>	err := os.Truncate(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-number">100</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="获取文件信息"><a href="#获取文件信息" class="headerlink" title="获取文件信息"></a>获取文件信息</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>    fileInfo os.FileInfo<br>    err      <span class="hljs-type">error</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 如果文件不存在，则返回错误</span><br>    fileInfo, err = os.Stat(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;File name:&quot;</span>, fileInfo.Name())					<span class="hljs-comment">//文件名，不是全路径</span><br>    fmt.Println(<span class="hljs-string">&quot;Size in bytes:&quot;</span>, fileInfo.Size())<br>    fmt.Println(<span class="hljs-string">&quot;Permissions:&quot;</span>, fileInfo.Mode())<br>    fmt.Println(<span class="hljs-string">&quot;Last modified:&quot;</span>, fileInfo.ModTime())<br>    fmt.Println(<span class="hljs-string">&quot;Is Directory: &quot;</span>, fileInfo.IsDir())<br>    fmt.Printf(<span class="hljs-string">&quot;System interface type: %T\n&quot;</span>, fileInfo.Sys())<br>    fmt.Printf(<span class="hljs-string">&quot;System info: %+v\n\n&quot;</span>, fileInfo.Sys())<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="重命名"><a href="#重命名" class="headerlink" title="重命名"></a>重命名</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	originalPath := <span class="hljs-string">&quot;test.txt&quot;</span><br>	newPath := <span class="hljs-string">&quot;test2.txt&quot;</span><br>	err := os.Rename(originalPath, newPath)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    err := os.Remove(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="打开和关闭文件"><a href="#打开和关闭文件" class="headerlink" title="打开和关闭文件"></a>打开和关闭文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 简单地以只读的方式打开。下面的例子会介绍读写的例子。</span><br>    file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    file.Close()<br><br>    <span class="hljs-comment">// OpenFile提供更多的选项。</span><br>    <span class="hljs-comment">// 最后一个参数是权限模式permission mode(三个八进制数字)</span><br>    <span class="hljs-comment">// 第二个是打开时的属性    </span><br>    file, err = os.OpenFile(<span class="hljs-string">&quot;test.txt&quot;</span>, os.O_APPEND, <span class="hljs-number">0666</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    file.Close()<br><br>    <span class="hljs-comment">// 下面的属性可以单独使用，也可以组合使用。</span><br>    <span class="hljs-comment">// 组合使用时可以使用 OR 操作设置 OpenFile的第二个参数，例如：</span><br>    <span class="hljs-comment">// os.O_CREATE|os.O_APPEND</span><br>    <span class="hljs-comment">// 或者 os.O_CREATE|os.O_TRUNC|os.O_WRONLY</span><br><br>    <span class="hljs-comment">// os.O_RDONLY // 只读</span><br>    <span class="hljs-comment">// os.O_WRONLY // 只写</span><br>    <span class="hljs-comment">// os.O_RDWR // 读写</span><br>    <span class="hljs-comment">// os.O_APPEND // 往文件中添建（Append）</span><br>    <span class="hljs-comment">// os.O_CREATE // 如果文件不存在则先创建</span><br>    <span class="hljs-comment">// os.O_TRUNC // 文件打开时裁剪文件</span><br>    <span class="hljs-comment">// os.O_EXCL // 和O_CREATE一起使用，文件不能存在</span><br>    <span class="hljs-comment">// os.O_SYNC // 以同步I/O的方式打开</span><br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="测试读写权限"><a href="#测试读写权限" class="headerlink" title="测试读写权限"></a>测试读写权限</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 这个例子测试写权限，如果没有写权限则返回error。</span><br>    <span class="hljs-comment">// 注意文件不存在也会返回error，需要检查error的信息来获取到底是哪个错误导致。</span><br>    file, err := os.OpenFile(<span class="hljs-string">&quot;test.txt&quot;</span>, os.O_WRONLY, <span class="hljs-number">0666</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">if</span> os.IsPermission(err) &#123;<br>            log.Println(<span class="hljs-string">&quot;Error: Write permission denied.&quot;</span>)<br>        &#125;<br>    &#125;<br>    file.Close()<br><br>    <span class="hljs-comment">// 测试读权限</span><br>    file, err = os.OpenFile(<span class="hljs-string">&quot;test.txt&quot;</span>, os.O_RDONLY, <span class="hljs-number">0666</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">if</span> os.IsPermission(err) &#123;<br>            log.Println(<span class="hljs-string">&quot;Error: Read permission denied.&quot;</span>)<br>        &#125;<br>    &#125;<br>    file.Close()<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="改变权限、拥有者、时间戳"><a href="#改变权限、拥有者、时间戳" class="headerlink" title="改变权限、拥有者、时间戳"></a>改变权限、拥有者、时间戳</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 使用Linux风格改变文件权限</span><br>    err := os.Chmod(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-number">0777</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Println(err)<br>    &#125;<br><br>    <span class="hljs-comment">// 改变文件所有者</span><br>    err = os.Chown(<span class="hljs-string">&quot;test.txt&quot;</span>, os.Getuid(), os.Getgid())<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Println(err)<br>    &#125;<br><br>    <span class="hljs-comment">// 改变时间戳</span><br>    twoDaysFromNow := time.Now().Add(<span class="hljs-number">48</span> * time.Hour)<br>    lastAccessTime := twoDaysFromNow<br>    lastModifyTime := twoDaysFromNow<br>    err = os.Chtimes(<span class="hljs-string">&quot;test.txt&quot;</span>, lastAccessTime, lastModifyTime)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Println(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="创建硬链接和软链接"><a href="#创建硬链接和软链接" class="headerlink" title="创建硬链接和软链接"></a>创建硬链接和软链接</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 创建一个硬链接。</span><br>    <span class="hljs-comment">// 创建后同一个文件内容会有两个文件名，改变一个文件的内容会影响另一个。</span><br>    <span class="hljs-comment">// 删除和重命名不会影响另一个。</span><br>    err := os.Link(<span class="hljs-string">&quot;original.txt&quot;</span>, <span class="hljs-string">&quot;original_also.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Println(<span class="hljs-string">&quot;creating sym&quot;</span>)<br>    <span class="hljs-comment">// Create a symlink</span><br>    err = os.Symlink(<span class="hljs-string">&quot;original.txt&quot;</span>, <span class="hljs-string">&quot;original_sym.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    <span class="hljs-comment">// Lstat返回一个文件的信息，但是当文件是一个软链接时，它返回软链接的信息，而不是引用的文件的信息。</span><br>    <span class="hljs-comment">// Symlink在Windows中不工作。</span><br>    fileInfo, err := os.Lstat(<span class="hljs-string">&quot;original_sym.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;Link info: %+v&quot;</span>, fileInfo)<br><br>    <span class="hljs-comment">//改变软链接的拥有者不会影响原始文件。</span><br>    err = os.Lchown(<span class="hljs-string">&quot;original_sym.txt&quot;</span>, os.Getuid(), os.Getgid())<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>







<h1 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h1><h2 id="复制文件"><a href="#复制文件" class="headerlink" title="复制文件"></a>复制文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;io&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 打开原始文件</span><br>    originalFile, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> originalFile.Close()<br><br>    <span class="hljs-comment">// 创建新的文件作为目标文件</span><br>    newFile, err := os.Create(<span class="hljs-string">&quot;test_copy.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> newFile.Close()<br><br>    <span class="hljs-comment">// 从源中复制字节到目标文件</span><br>    bytesWritten, err := io.Copy(newFile, originalFile)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Copied %d bytes.&quot;</span>, bytesWritten)<br><br>    <span class="hljs-comment">// 将文件内容flush到硬盘中</span><br>    err = newFile.Sync()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br></code></pre></td></tr></table></figure>







<h2 id="跳转到文件指定位置-Seek"><a href="#跳转到文件指定位置-Seek" class="headerlink" title="跳转到文件指定位置(Seek)"></a>跳转到文件指定位置(Seek)</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    file, _ := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">defer</span> file.Close()<br><br>    <span class="hljs-comment">// 偏离位置，可以是正数也可以是负数</span><br>    <span class="hljs-keyword">var</span> offset <span class="hljs-type">int64</span> = <span class="hljs-number">5</span><br><br>    <span class="hljs-comment">// 用来计算offset的初始位置</span><br>    <span class="hljs-comment">// 0 = 文件开始位置</span><br>    <span class="hljs-comment">// 1 = 当前位置</span><br>    <span class="hljs-comment">// 2 = 文件结尾处</span><br>    <span class="hljs-keyword">var</span> whence <span class="hljs-type">int</span> = <span class="hljs-number">0</span><br>    newPosition, err := file.Seek(offset, whence)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;Just moved to 5:&quot;</span>, newPosition)<br><br>    <span class="hljs-comment">// 从当前位置回退两个字节</span><br>    newPosition, err = file.Seek(<span class="hljs-number">-2</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;Just moved back two:&quot;</span>, newPosition)<br><br>    <span class="hljs-comment">// 使用下面的技巧得到当前的位置</span><br>    currentPosition, err := file.Seek(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>    fmt.Println(<span class="hljs-string">&quot;Current position:&quot;</span>, currentPosition)<br><br>    <span class="hljs-comment">// 转到文件开始处</span><br>    newPosition, err = file.Seek(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;Position after seeking 0,0:&quot;</span>, newPosition)<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 可写方式打开文件</span><br>    file, err := os.OpenFile(<br>        <span class="hljs-string">&quot;test.txt&quot;</span>,<br>        os.O_WRONLY|os.O_TRUNC|os.O_CREATE,<span class="hljs-comment">//清空文件</span><br>        <span class="hljs-number">0666</span>,<br>    )<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> file.Close()<br><br>    <span class="hljs-comment">// 写字节到文件中</span><br>    byteSlice := []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Bytes!\n&quot;</span>)<br>    bytesWritten, err := file.Write(byteSlice)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Wrote %d bytes.\n&quot;</span>, bytesWritten)<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="快写文件"><a href="#快写文件" class="headerlink" title="快写文件"></a>快写文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;io/ioutil&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    err := ioutil.WriteFile(<span class="hljs-string">&quot;test.txt&quot;</span>, []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Hi\n&quot;</span>), <span class="hljs-number">0666</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="bufferedWriter"><a href="#bufferedWriter" class="headerlink" title="bufferedWriter"></a>bufferedWriter</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;bufio&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 打开文件，只写</span><br>    file, err := os.OpenFile(<span class="hljs-string">&quot;test.txt&quot;</span>, os.O_WRONLY, <span class="hljs-number">0666</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> file.Close()<br><br>    <span class="hljs-comment">// 为这个文件创建buffered writer</span><br>    bufferedWriter := bufio.NewWriter(file)<br><br>    <span class="hljs-comment">// 写字节到buffer</span><br>    bytesWritten, err := bufferedWriter.Write(<br>        []<span class="hljs-type">byte</span>&#123;<span class="hljs-number">65</span>, <span class="hljs-number">66</span>, <span class="hljs-number">67</span>&#125;,<br>    )<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Bytes written: %d\n&quot;</span>, bytesWritten)<br><br>    <span class="hljs-comment">// 写字符串到buffer</span><br>    <span class="hljs-comment">// 也可以使用 WriteRune() 和 WriteByte()   </span><br>    bytesWritten, err = bufferedWriter.WriteString(<br>        <span class="hljs-string">&quot;Buffered string\n&quot;</span>,<br>    )<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Bytes written: %d\n&quot;</span>, bytesWritten)<br><br>    <span class="hljs-comment">// 检查缓存中的字节数</span><br>    unflushedBufferSize := bufferedWriter.Buffered()<br>    log.Printf(<span class="hljs-string">&quot;Bytes buffered: %d\n&quot;</span>, unflushedBufferSize)<br><br>    <span class="hljs-comment">// 还有多少字节可用（未使用的缓存大小）</span><br>    bytesAvailable := bufferedWriter.Available()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Available buffer: %d\n&quot;</span>, bytesAvailable)<br><br>    <span class="hljs-comment">// 写内存buffer到硬盘</span><br>    bufferedWriter.Flush()<br><br>    <span class="hljs-comment">// 当你想将缓存传给另外一个writer时有用</span><br>    bufferedWriter.Reset(bufferedWriter)<br><br>    bytesAvailable = bufferedWriter.Available()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Available buffer: %d\n&quot;</span>, bytesAvailable)<br><br>    <span class="hljs-comment">// 重新设置缓存的大小。</span><br>    <span class="hljs-comment">// 第一个参数是缓存应该输出到哪里，这个例子中我们使用相同的writer。</span><br>    <span class="hljs-comment">// 如果我们设置的新的大小小于第一个参数writer的缓存大小， 比如10，我们不会得到一个10字节大小的缓存，</span><br>    <span class="hljs-comment">// 而是writer的原始大小的缓存，默认是4096。</span><br>    <span class="hljs-comment">// 它的功能主要还是为了扩容。</span><br>    bufferedWriter = bufio.NewWriterSize(<br>        bufferedWriter,<br>        <span class="hljs-number">8000</span>,<br>    )<br><br>    <span class="hljs-comment">// resize后检查缓存的大小</span><br>    bytesAvailable = bufferedWriter.Available()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Available buffer: %d\n&quot;</span>, bytesAvailable)<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="读取最多N个字节"><a href="#读取最多N个字节" class="headerlink" title="读取最多N个字节"></a>读取最多N个字节</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 打开文件，只读</span><br>    file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> file.Close()<br><br>    <span class="hljs-comment">// 从文件中读取len(b)字节的文件。</span><br>    <span class="hljs-comment">// 返回0字节意味着读取到文件尾了</span><br>    <span class="hljs-comment">// 读取到文件会返回io.EOF的error</span><br>    byteSlice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">16</span>)<br>    bytesRead, err := file.Read(byteSlice)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Number of bytes read: %d\n&quot;</span>, bytesRead)<br>    log.Printf(<span class="hljs-string">&quot;Data read: %s\n&quot;</span>, byteSlice)<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="读取正好N个字节"><a href="#读取正好N个字节" class="headerlink" title="读取正好N个字节"></a>读取正好N个字节</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;io&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// Open file for reading</span><br>    file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    <span class="hljs-comment">// file.Read()可以读取一个小文件到大的byte slice中，</span><br>    <span class="hljs-comment">// 但是io.ReadFull()在文件的字节数小于byte slice字节数的时候会返回错误</span><br>    byteSlice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">2</span>)<br>    numBytesRead, err := io.ReadFull(file, byteSlice)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Number of bytes read: %d\n&quot;</span>, numBytesRead)<br>    log.Printf(<span class="hljs-string">&quot;Data read: %s\n&quot;</span>, byteSlice)<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="读取至少N个字节"><a href="#读取至少N个字节" class="headerlink" title="读取至少N个字节"></a>读取至少N个字节</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;io&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 打开文件，只读</span><br>    file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    byteSlice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">512</span>)<br>    minBytes := <span class="hljs-number">8</span><br>    <span class="hljs-comment">// io.ReadAtLeast()在不能得到最小的字节的时候会返回错误，但会把已读的文件保留</span><br>    numBytesRead, err := io.ReadAtLeast(file, byteSlice, minBytes)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    log.Printf(<span class="hljs-string">&quot;Number of bytes read: %d\n&quot;</span>, numBytesRead)<br>    log.Printf(<span class="hljs-string">&quot;Data read: %s\n&quot;</span>, byteSlice)<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="读取全部字节"><a href="#读取全部字节" class="headerlink" title="读取全部字节"></a>读取全部字节</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;io/ioutil&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    <span class="hljs-comment">// os.File.Read(), io.ReadFull() 和</span><br>    <span class="hljs-comment">// io.ReadAtLeast() 在读取之前都需要一个固定大小的byte slice。</span><br>    <span class="hljs-comment">// 但ioutil.ReadAll()会读取reader(这个例子中是file)的每一个字节，然后把字节slice返回。</span><br>    data, err := ioutil.ReadAll(file)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    fmt.Printf(<span class="hljs-string">&quot;Data as hex: %x\n&quot;</span>, data)<br>    fmt.Printf(<span class="hljs-string">&quot;Data as string: %s\n&quot;</span>, data)<br>    fmt.Println(<span class="hljs-string">&quot;Number of bytes read:&quot;</span>, <span class="hljs-built_in">len</span>(data))<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="快读到内存"><a href="#快读到内存" class="headerlink" title="快读到内存"></a>快读到内存</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;io/ioutil&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 读取文件到byte slice中</span><br>    data, err := ioutil.ReadFile(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    log.Printf(<span class="hljs-string">&quot;Data read: %s\n&quot;</span>, data)<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="bufferedReader"><a href="#bufferedReader" class="headerlink" title="bufferedReader"></a>bufferedReader</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;bufio&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 打开文件，创建buffered reader</span><br>    file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    bufferedReader := bufio.NewReader(file)<br><br>    <span class="hljs-comment">// 得到字节，当前指针不变</span><br>    byteSlice := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">5</span>)<br>    byteSlice, err = bufferedReader.Peek(<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;Peeked at 5 bytes: %s\n&quot;</span>, byteSlice)<br><br>    <span class="hljs-comment">// 读取，指针同时移动</span><br>    numBytesRead, err := bufferedReader.Read(byteSlice)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;Read %d bytes: %s\n&quot;</span>, numBytesRead, byteSlice)<br><br>    <span class="hljs-comment">// 读取一个字节, 如果读取不成功会返回Error</span><br>    myByte, err := bufferedReader.ReadByte()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;Read 1 byte: %c\n&quot;</span>, myByte)     <br><br>    <span class="hljs-comment">// 读取到分隔符，包含分隔符，返回byte slice</span><br>    dataBytes, err := bufferedReader.ReadBytes(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;Read bytes: %s\n&quot;</span>, dataBytes)           <br><br>    <span class="hljs-comment">// 读取到分隔符，包含分隔符，返回字符串</span><br>    dataString, err := bufferedReader.ReadString(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    fmt.Printf(<span class="hljs-string">&quot;Read string: %s\n&quot;</span>, dataString)     <br><br>    <span class="hljs-comment">//这个例子读取了很多行，所以test.txt应该包含多行文本才不至于出错</span><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="使用-scanner"><a href="#使用-scanner" class="headerlink" title="使用 scanner"></a>使用 scanner</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;bufio&quot;</span><br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>	scanner := bufio.NewScanner(file)<br><br>	<span class="hljs-comment">// 缺省的分隔函数是bufio.ScanLines,我们这里使用ScanWords。</span><br>	<span class="hljs-comment">// 也可以定制一个SplitFunc类型的分隔函数</span><br>	scanner.Split(bufio.ScanWords)<br><br>	<span class="hljs-comment">// scan下一个token.</span><br>	success := scanner.Scan()<br>	<span class="hljs-keyword">if</span> success == <span class="hljs-literal">false</span> &#123;<br>		<span class="hljs-comment">// 出现错误或者EOF是返回Error</span><br>		err = scanner.Err()<br>		<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<br>			log.Println(<span class="hljs-string">&quot;Scan completed and reached EOF&quot;</span>)<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			log.Fatal(err)<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// 得到数据，Bytes() 或者 Text()</span><br>	fmt.Println(<span class="hljs-string">&quot;First word found:&quot;</span>, scanner.Text())<br><br>	<span class="hljs-comment">// 再次调用scanner.Scan()发现下一个token</span><br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="文件压缩"><a href="#文件压缩" class="headerlink" title="文件压缩"></a>文件压缩</h1><h2 id="打包-zip-文件"><a href="#打包-zip-文件" class="headerlink" title="打包(zip) 文件"></a>打包(zip) 文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// This example uses zip but standard library</span><br><span class="hljs-comment">// also supports tar archives</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;archive/zip&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 创建一个打包文件</span><br>    outFile, err := os.Create(<span class="hljs-string">&quot;test.zip&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> outFile.Close()<br><br>    <span class="hljs-comment">// 创建zip writer</span><br>    zipWriter := zip.NewWriter(outFile)<br><br><br>    <span class="hljs-comment">// 往打包文件中写文件。</span><br>    <span class="hljs-comment">// 这里我们使用硬编码的内容，你可以遍历一个文件夹，把文件夹下的文件以及它们的内容写入到这个打包文件中。</span><br>    <span class="hljs-keyword">var</span> filesToArchive = []<span class="hljs-keyword">struct</span> &#123;<br>        Name, Body <span class="hljs-type">string</span><br>    &#125; &#123;<br>        &#123;<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;String contents of file&quot;</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;test2.txt&quot;</span>, <span class="hljs-string">&quot;\x61\x62\x63\n&quot;</span>&#125;,<br>    &#125;<br><br>    <span class="hljs-comment">// 下面将要打包的内容写入到打包文件中，依次写入。</span><br>    <span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> filesToArchive &#123;<br>            fileWriter, err := zipWriter.Create(file.Name)<br>            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>                    log.Fatal(err)<br>            &#125;<br>            _, err = fileWriter.Write([]<span class="hljs-type">byte</span>(file.Body))<br>            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>                    log.Fatal(err)<br>            &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 清理</span><br>    err = zipWriter.Close()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="抽取-unzip-文件"><a href="#抽取-unzip-文件" class="headerlink" title="抽取(unzip) 文件"></a>抽取(unzip) 文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// This example uses zip but standard library</span><br><span class="hljs-comment">// also supports tar archives</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;archive/zip&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;io&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;path/filepath&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    zipReader, err := zip.OpenReader(<span class="hljs-string">&quot;test.zip&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> zipReader.Close()<br><br>    <span class="hljs-comment">// 遍历打包文件中的每一文件/文件夹</span><br>    <span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> zipReader.Reader.File &#123;<br>        <span class="hljs-comment">// 打包文件中的文件就像普通的一个文件对象一样</span><br>        zippedFile, err := file.Open()<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            log.Fatal(err)<br>        &#125;<br>        <span class="hljs-keyword">defer</span> zippedFile.Close()<br><br>        <span class="hljs-comment">// 指定抽取的文件名。</span><br>        <span class="hljs-comment">// 你可以指定全路径名或者一个前缀，这样可以把它们放在不同的文件夹中。</span><br>        <span class="hljs-comment">// 我们这个例子使用打包文件中相同的文件名。</span><br>        targetDir := <span class="hljs-string">&quot;./&quot;</span><br>        extractedFilePath := filepath.Join(<br>            targetDir,<br>            file.Name,<br>        )<br><br>        <span class="hljs-comment">// 抽取项目或者创建文件夹</span><br>        <span class="hljs-keyword">if</span> file.FileInfo().IsDir() &#123;<br>            <span class="hljs-comment">// 创建文件夹并设置同样的权限</span><br>            log.Println(<span class="hljs-string">&quot;Creating directory:&quot;</span>, extractedFilePath)<br>            os.MkdirAll(extractedFilePath, file.Mode())<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//抽取正常的文件</span><br>            log.Println(<span class="hljs-string">&quot;Extracting file:&quot;</span>, file.Name)<br><br>            outputFile, err := os.OpenFile(<br>                extractedFilePath,<br>                os.O_WRONLY|os.O_CREATE|os.O_TRUNC,<br>                file.Mode(),<br>            )<br>            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>                log.Fatal(err)<br>            &#125;<br>            <span class="hljs-keyword">defer</span> outputFile.Close()<br><br>            <span class="hljs-comment">// 通过io.Copy简洁地复制文件内容</span><br>            _, err = io.Copy(outputFile, zippedFile)<br>            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>                log.Fatal(err)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="压缩文件"><a href="#压缩文件" class="headerlink" title="压缩文件"></a>压缩文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 这个例子中使用gzip压缩格式，标准库还支持zlib, bz2, flate, lzw</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;compress/gzip&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    outputFile, err := os.Create(<span class="hljs-string">&quot;test.txt.gz&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    gzipWriter := gzip.NewWriter(outputFile)<br>    <span class="hljs-keyword">defer</span> gzipWriter.Close()<br><br>    <span class="hljs-comment">// 当我们写如到gizp writer数据时，它会依次压缩数据并写入到底层的文件中。</span><br>    <span class="hljs-comment">// 我们不必关心它是如何压缩的，还是像普通的writer一样操作即可。</span><br>    _, err = gzipWriter.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Gophers rule!\n&quot;</span>))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    log.Println(<span class="hljs-string">&quot;Compressed data written to file.&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="解压缩文件"><a href="#解压缩文件" class="headerlink" title="解压缩文件"></a>解压缩文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 这个例子中使用gzip压缩格式，标准库还支持zlib, bz2, flate, lzw</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;compress/gzip&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;io&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 打开一个gzip文件。</span><br>    <span class="hljs-comment">// 文件是一个reader,但是我们可以使用各种数据源，比如web服务器返回的gzipped内容，</span><br>    <span class="hljs-comment">// 它的内容不是一个文件，而是一个内存流</span><br>    gzipFile, err := os.Open(<span class="hljs-string">&quot;test.txt.gz&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    gzipReader, err := gzip.NewReader(gzipFile)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> gzipReader.Close()<br><br>    <span class="hljs-comment">// 解压缩到一个writer,它是一个file writer</span><br>    outfileWriter, err := os.Create(<span class="hljs-string">&quot;unzipped.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> outfileWriter.Close()<br><br>    <span class="hljs-comment">// 复制内容</span><br>    _, err = io.Copy(outfileWriter, gzipReader)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="文件其它操作"><a href="#文件其它操作" class="headerlink" title="文件其它操作"></a>文件其它操作</h1><h2 id="临时文件和目录"><a href="#临时文件和目录" class="headerlink" title="临时文件和目录"></a>临时文件和目录</h2><p><code>ioutil</code>提供了两个函数: <code>TempDir()</code> 和 <code>TempFile()</code>。 使用完毕后，调用者负责删除这些临时文件和文件夹。 有一点好处就是当你传递一个空字符串作为文件夹名的时候，它会在操作系统的临时文件夹中创建这些项目（&#x2F;tmp on Linux）。 <code>os.TempDir()</code>返回当前操作系统的临时文件夹。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>     <span class="hljs-string">&quot;os&quot;</span><br>     <span class="hljs-string">&quot;io/ioutil&quot;</span><br>     <span class="hljs-string">&quot;log&quot;</span><br>     <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>     <span class="hljs-comment">// 在系统临时文件夹中创建一个临时文件夹</span><br>     tempDirPath, err := ioutil.TempDir(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;myTempDir&quot;</span>)<br>     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>          log.Fatal(err)<br>     &#125;<br>     fmt.Println(<span class="hljs-string">&quot;Temp dir created:&quot;</span>, tempDirPath)<br><br>     <span class="hljs-comment">// 在临时文件夹中创建临时文件</span><br>     tempFile, err := ioutil.TempFile(tempDirPath, <span class="hljs-string">&quot;myTempFile.txt&quot;</span>)<br>     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>          log.Fatal(err)<br>     &#125;<br>     fmt.Println(<span class="hljs-string">&quot;Temp file created:&quot;</span>, tempFile.Name())<br><br>     <span class="hljs-comment">// ... 做一些操作 ...</span><br><br>     <span class="hljs-comment">// 关闭文件</span><br>     err = tempFile.Close()<br>     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    <span class="hljs-comment">// 删除我们创建的资源</span><br>     err = os.Remove(tempFile.Name())<br>     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>     err = os.Remove(tempDirPath)<br>     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="通过HTTP下载文件"><a href="#通过HTTP下载文件" class="headerlink" title="通过HTTP下载文件"></a>通过HTTP下载文件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>     <span class="hljs-string">&quot;os&quot;</span><br>     <span class="hljs-string">&quot;io&quot;</span><br>     <span class="hljs-string">&quot;log&quot;</span><br>     <span class="hljs-string">&quot;net/http&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>     newFile, err := os.Create(<span class="hljs-string">&quot;devdungeon.html&quot;</span>)<br>     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>          log.Fatal(err)<br>     &#125;<br>     <span class="hljs-keyword">defer</span> newFile.Close()<br><br>     url := <span class="hljs-string">&quot;http://www.devdungeon.com/archive&quot;</span><br>     response, err := http.Get(url)<br>     <span class="hljs-keyword">defer</span> response.Body.Close()<br><br>     <span class="hljs-comment">// 将HTTP response Body中的内容写入到文件</span><br>     <span class="hljs-comment">// Body满足reader接口，因此我们可以使用ioutil.Copy</span><br>     numBytesWritten, err := io.Copy(newFile, response.Body)<br>     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>          log.Fatal(err)<br>     &#125;<br>     log.Printf(<span class="hljs-string">&quot;Downloaded %d byte file.\n&quot;</span>, numBytesWritten)<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="哈希和摘要"><a href="#哈希和摘要" class="headerlink" title="哈希和摘要"></a>哈希和摘要</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;crypto/md5&quot;</span><br>    <span class="hljs-string">&quot;crypto/sha1&quot;</span><br>    <span class="hljs-string">&quot;crypto/sha256&quot;</span><br>    <span class="hljs-string">&quot;crypto/sha512&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;io/ioutil&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 得到文件内容</span><br>    data, err := ioutil.ReadFile(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    <span class="hljs-comment">// 计算Hash</span><br>    fmt.Printf(<span class="hljs-string">&quot;Md5: %x\n\n&quot;</span>, md5.Sum(data))<br>    fmt.Printf(<span class="hljs-string">&quot;Sha1: %x\n\n&quot;</span>, sha1.Sum(data))<br>    fmt.Printf(<span class="hljs-string">&quot;Sha256: %x\n\n&quot;</span>, sha256.Sum256(data))<br>    fmt.Printf(<span class="hljs-string">&quot;Sha512: %x\n\n&quot;</span>, sha512.Sum512(data))<br>&#125;<br></code></pre></td></tr></table></figure>

<p>上面的例子复制整个文件内容到内存中，传递给hash函数。 另一个方式是创建一个hash writer, 使用<code>Write</code>、<code>WriteString</code>、<code>Copy</code>将数据传给它。 下面的例子使用 md5 hash,但你可以使用其它的Writer。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;crypto/md5&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;io&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    file, err := os.Open(<span class="hljs-string">&quot;test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> file.Close()<br><br>    <span class="hljs-comment">//创建一个新的hasher,满足writer接口</span><br>    hasher := md5.New()<br>    _, err = io.Copy(hasher, file)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        log.Fatal(err)<br>    &#125;<br><br>    <span class="hljs-comment">// 计算hash并打印结果。</span><br>    <span class="hljs-comment">// 传递 nil 作为参数，因为我们不通过参数传递数据，而是通过writer接口。</span><br>    sum := hasher.Sum(<span class="hljs-literal">nil</span>)<br>    fmt.Printf(<span class="hljs-string">&quot;Md5 checksum: %x\n&quot;</span>, sum)<br>&#125;<br></code></pre></td></tr></table></figure>





<h1 id="常用技巧"><a href="#常用技巧" class="headerlink" title="常用技巧"></a>常用技巧</h1><h2 id="递归遍历目录"><a href="#递归遍历目录" class="headerlink" title="递归遍历目录"></a>递归遍历目录</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;path/filepath&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    root := <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-comment">// 从当前目录开始</span><br>    err := filepath.Walk(root, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(path <span class="hljs-type">string</span>, info os.FileInfo, err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            <span class="hljs-keyword">return</span> err<br>        &#125;<br>        fmt.Println(path)    <span class="hljs-comment">//path是相对于root的全路径</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    &#125;)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;遍历目录发生错误: %v\n&quot;</span>, err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>









<h2 id="递归统计目录文件大小"><a href="#递归统计目录文件大小" class="headerlink" title="递归统计目录文件大小"></a>递归统计目录文件大小</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// DirSize 获取一个目录的大小</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DirSize</span><span class="hljs-params">(dirPath <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">int64</span>, <span class="hljs-type">error</span>) &#123;<br>	<span class="hljs-keyword">var</span> size <span class="hljs-type">int64</span><br>	err := filepath.Walk(dirPath, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(path <span class="hljs-type">string</span>, info fs.FileInfo, err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">return</span> err<br>		&#125;<br>		<span class="hljs-keyword">if</span> !info.IsDir() &#123;<br>			size += info.Size()<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>	&#125;)<br>	<span class="hljs-keyword">return</span> size, err<br>&#125;<br></code></pre></td></tr></table></figure>







<h2 id="备份目录"><a href="#备份目录" class="headerlink" title="备份目录"></a>备份目录</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CopyDir</span><span class="hljs-params">(src, dest <span class="hljs-type">string</span>, exclude []<span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>	src = filepath.Clean(src)   <span class="hljs-comment">// 确保源路径是标准化的</span><br>	dest = filepath.Clean(dest) <span class="hljs-comment">// 确保目标路径是标准化的</span><br><br>	<span class="hljs-keyword">if</span> _, err := os.Stat(dest); os.IsNotExist(err) &#123;<br>		<span class="hljs-keyword">if</span> err := os.MkdirAll(dest, os.ModePerm); err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">return</span> err<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-keyword">return</span> filepath.Walk(src, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(path <span class="hljs-type">string</span>, info fs.FileInfo, err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>		normalizedPath := filepath.Clean(path)                            <span class="hljs-comment">// 标准化当前路径</span><br>		fileName := strings.TrimPrefix(normalizedPath, src)               <span class="hljs-comment">// 去除src前缀</span><br>		fileName = strings.TrimPrefix(fileName, <span class="hljs-type">string</span>(os.PathSeparator)) <span class="hljs-comment">// 去除开头的路径分隔符</span><br><br>		<span class="hljs-keyword">if</span> fileName == <span class="hljs-string">&quot;&quot;</span> &#123; <span class="hljs-comment">// 如果是src目录本身，直接返回</span><br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>		&#125;<br>		<span class="hljs-comment">// 检查是否在排除列表中</span><br>		<span class="hljs-keyword">for</span> _, e := <span class="hljs-keyword">range</span> exclude &#123;<br>			matched, err := filepath.Match(e, info.Name())<br>			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>				<span class="hljs-keyword">return</span> err<br>			&#125;<br>			<span class="hljs-keyword">if</span> matched &#123;<br>				<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">if</span> info.IsDir() &#123; <span class="hljs-comment">// 如果是目录，创建目录</span><br>			<span class="hljs-keyword">return</span> os.Mkdir(filepath.Join(dest, fileName), info.Mode())<br>		&#125;<br>		<span class="hljs-comment">// 如果是文件，拷贝文件</span><br>		data, err := os.ReadFile(filepath.Join(src, fileName))<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">return</span> err<br>		&#125;<br>		<span class="hljs-keyword">return</span> os.WriteFile(filepath.Join(dest, fileName), data, info.Mode())<br>	&#125;)<br>&#125;<br></code></pre></td></tr></table></figure>







<h2 id="获取磁盘大小"><a href="#获取磁盘大小" class="headerlink" title="获取磁盘大小"></a>获取磁盘大小</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// AvailableDiskSize 获取磁盘剩余可以空间大小</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AvailableDiskSize</span><span class="hljs-params">()</span></span> (<span class="hljs-type">uint64</span>, <span class="hljs-type">error</span>) &#123;<br>	wd, err := syscall.Getwd()<span class="hljs-comment">//获取当前工作目录的完整路径</span><br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, err<br>	&#125;<br>	<span class="hljs-keyword">var</span> stat syscall.Statfs_t<br>	<span class="hljs-keyword">if</span> err = syscall.Statfs(wd, &amp;stat); err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, err<br>	&#125;<br>	<span class="hljs-keyword">return</span> stat.Bavail * <span class="hljs-type">uint64</span>(stat.Bsize), <span class="hljs-literal">nil</span>		<span class="hljs-comment">//块的数量和每块的字节大小</span><br>&#125;<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/go/" class="category-chain-item">go</a>
  
  
    <span>></span>
    
  <a href="/categories/go/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" class="category-chain-item">文件操作</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/go/" class="print-no-link">#go</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>go语法</div>
      <div>http://example.com/2024/03/24/go/go文件操作/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Mrxiad</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年3月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/03/24/go/go%E5%AE%9A%E6%97%B6%E5%99%A8/" title="go语法">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">go语法</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/03/24/go/tcp/" title="go语法">
                        <span class="hidden-mobile">go语法</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
